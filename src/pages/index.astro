---
import {neonSql} from "../clients/neon";
import HtmlLayout from "../layouts/HtmlLayout.astro";
import {Skills} from "../components/skills/skills";
import {getExperienceBreakdown} from "../util/job/get-experience-breakdown";
import type {GetJobsJson} from "./api/job";

const clerkKey = import.meta.env.CLERK_PUBLISHABLE_KEY;
const pathname = Astro.url.pathname;

const jobs = await neonSql`select * from "Job"` as GetJobsJson;

const {sorted, max} = getExperienceBreakdown(jobs);
---

<HtmlLayout>
	<Skills
		client:load
		clerkKey={clerkKey}
		experiences={sorted}
		max={max}
		currentPathname={pathname}
	/>
</HtmlLayout>
